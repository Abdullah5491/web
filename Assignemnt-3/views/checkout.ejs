<%- include('partials/header') %>
    <link rel="stylesheet" href="/css/checkout-styles.css" />

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="container-cl about-hero-padding">
            <div class="hero">
                <h1 class="global-h1">Checkout</h1>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <section class="section-white" style="padding: 60px 0;">
        <div class="container">
            <div class="row g-4">
                <!-- Left Column - Forms -->
                <div class="col-12 col-lg-7">
                    <!-- Customer & Shipping Information -->
                    <div class="checkout-form-section">
                        <h2 class="checkout-section-title">
                            <i class="bi bi-person-fill me-2"></i>Customer & Shipping Information
                        </h2>
                        <form id="checkoutForm" class="needs-validation" novalidate>
                            <div class="row g-3">
                                <!-- Full Name -->
                                <div class="col-12">
                                    <label for="fullName" class="form-label">Full Name <span
                                            class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="fullName" placeholder="John Doe"
                                        required />
                                    <div class="invalid-feedback">
                                        Please provide your full name.
                                    </div>
                                </div>

                                <!-- Email -->
                                <div class="col-md-6">
                                    <label for="email" class="form-label">Email Address <span
                                            class="text-danger">*</span></label>
                                    <input type="email" class="form-control" id="email"
                                        placeholder="john.doe@example.com" required />
                                    <div class="invalid-feedback">
                                        Please provide a valid email address.
                                    </div>
                                </div>

                                <!-- Phone -->
                                <div class="col-md-6">
                                    <label for="phone" class="form-label">Phone Number <span
                                            class="text-danger">*</span></label>
                                    <input type="tel" class="form-control" id="phone" placeholder="+1 (555) 123-4567"
                                        pattern="[0-9+\s\-()]{10,}" required />
                                    <div class="invalid-feedback">
                                        Please provide a valid phone number.
                                    </div>
                                </div>

                                <!-- Address -->
                                <div class="col-12">
                                    <label for="address" class="form-label">Street Address <span
                                            class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="address"
                                        placeholder="123 Main Street, Apt 4B" required />
                                    <div class="invalid-feedback">
                                        Please provide your street address.
                                    </div>
                                </div>

                                <!-- City, Postal Code, Country -->
                                <div class="col-md-5">
                                    <label for="city" class="form-label">City <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="city" placeholder="New York" required />
                                    <div class="invalid-feedback">
                                        Please provide your city.
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <label for="postalCode" class="form-label">Postal Code <span
                                            class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="postalCode" placeholder="10001"
                                        required />
                                    <div class="invalid-feedback">
                                        Required.
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <label for="country" class="form-label">Country <span
                                            class="text-danger">*</span></label>
                                    <select class="form-select" id="country" required>
                                        <option value="" selected disabled>Choose...</option>
                                        <option value="US">United States</option>
                                        <option value="CA">Canada</option>
                                        <option value="UK">United Kingdom</option>
                                        <option value="AU">Australia</option>
                                        <option value="PK">Pakistan</option>
                                        <option value="IN">India</option>
                                        <option value="AE">United Arab Emirates</option>
                                        <option value="SA">Saudi Arabia</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please select a country.
                                    </div>
                                </div>

                                <!-- Billing Same as Shipping -->
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="billingSame" checked />
                                        <label class="form-check-label" for="billingSame">
                                            Billing address is the same as shipping address
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Payment Section -->
                    <div class="checkout-form-section">
                        <h2 class="checkout-section-title">
                            <i class="bi bi-wallet2 me-2"></i>Payment Method
                        </h2>

                        <!-- Payment Options -->
                        <div class="row g-3 mb-4">
                            <div class="col-12 col-md-4">
                                <div class="payment-option">
                                    <input type="radio" class="btn-check" name="paymentMethod" id="paymentCard"
                                        autocomplete="off" checked />
                                    <label class="w-100 text-center" for="paymentCard">
                                        <i class="bi bi-credit-card fs-3 d-block mb-2"></i>
                                        <strong>Credit/Debit Card</strong>
                                    </label>
                                </div>
                            </div>

                            <div class="col-12 col-md-4">
                                <div class="payment-option">
                                    <input type="radio" class="btn-check" name="paymentMethod" id="paymentCOD"
                                        autocomplete="off" />
                                    <label class="w-100 text-center" for="paymentCOD">
                                        <i class="bi bi-cash fs-3 d-block mb-2"></i>
                                        <strong>Cash on Delivery</strong>
                                    </label>
                                </div>
                            </div>

                            <div class="col-12 col-md-4">
                                <div class="payment-option">
                                    <input type="radio" class="btn-check" name="paymentMethod" id="paymentWallet"
                                        autocomplete="off" />
                                    <label class="w-100 text-center" for="paymentWallet">
                                        <i class="bi bi-wallet fs-3 d-block mb-2"></i>
                                        <strong>Digital Wallet</strong>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Card Details (Conditional) -->
                        <div id="cardDetails" class="card-details show">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label for="cardholderName" class="form-label">Cardholder Name <span
                                            class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="cardholderName"
                                        placeholder="John Doe" />
                                    <div class="invalid-feedback">
                                        Cardholder name is required.
                                    </div>
                                </div>

                                <div class="col-12">
                                    <label for="cardNumber" class="form-label">Card Number <span
                                            class="text-danger">*</span></label>
                                    <input type="text" class="form-control card-number-input" id="cardNumber"
                                        placeholder="1234 5678 9012 3456" maxlength="19" />
                                    <div class="invalid-feedback">
                                        Card number is required.
                                    </div>
                                </div>

                                <div class="col-6 col-md-6">
                                    <label for="expiryDate" class="form-label">Expiry Date <span
                                            class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="expiryDate" placeholder="MM/YY"
                                        maxlength="5" />
                                    <div class="invalid-feedback">
                                        Expiry date is required.
                                    </div>
                                </div>

                                <div class="col-6 col-md-6">
                                    <label for="cvv" class="form-label">CVV <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="cvv" placeholder="123" maxlength="4" />
                                    <div class="invalid-feedback">
                                        CVV is required.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- COD Message -->
                        <div id="codMessage" class="card-details alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            Pay with cash upon delivery. Please keep exact change ready.
                        </div>

                        <!-- Wallet Message -->
                        <div id="walletMessage" class="card-details alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            You will be redirected to complete payment via your digital wallet.
                        </div>
                    </div>

                    <!-- Review & Place Order -->
                    <div class="checkout-form-section">
                        <h2 class="checkout-section-title">
                            <i class="bi bi-check-circle me-2"></i>Review & Confirm
                        </h2>

                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="termsCheck" />
                            <label class="form-check-label" for="termsCheck">
                                I agree to the <a href="#" class="text-decoration-none">Terms & Conditions</a> and <a
                                    href="#" class="text-decoration-none">Privacy Policy</a> <span
                                    class="text-danger">*</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Right Column - Order Summary -->
                <div class="col-12 col-lg-5">
                    <div class="order-summary-sticky">
                        <div class="checkout-order-summary">
                            <h3 class="checkout-section-title">
                                <i class="bi bi-bag-check me-2"></i>Order Summary
                            </h3>

                            <!-- Product List -->
                            <div class="mb-4" id="cart-items-container">
                                <!-- Cart items will be injected here by JS -->
                                <div class="text-center text-muted py-3 empty-cart-msg">Your cart is empty</div>
                            </div>

                            <!-- Coupon Code -->
                            <div class="mb-4">
                                <label for="couponCode" class="form-label small text-muted">Have a coupon code?</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="couponCode" placeholder="Enter code" />
                                    <button class="btn btn-outline-primary" type="button">
                                        Apply
                                    </button>
                                </div>
                            </div>

                            <!-- Price Breakdown -->
                            <div class="border-top pt-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Subtotal</span>
                                    <span id="cart-subtotal">$0.00</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Shipping</span>
                                    <span id="cart-shipping">$0.00</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Tax (0%)</span>
                                    <span id="cart-tax">$0.00</span>
                                </div>
                                <div class="checkout-total-row">
                                    <span>Grand Total</span>
                                    <span id="cart-total">$0.00</span>
                                </div>
                            </div>

                            <!-- Place Order Button -->
                            <button type="submit" class="contact-btn w-100 mt-4" id="placeOrderBtn" disabled>
                                Place Order
                            </button>

                            <!-- Trust Badges -->
                            <div class="mt-3 text-center">
                                <small class="text-muted d-block mb-2">
                                    <i class="bi bi-truck me-1"></i>Free returns within 30 days
                                </small>
                                <small class="text-muted d-block">
                                    <i class="bi bi-shield-check me-1"></i>100% Secure Checkout
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Custom JavaScript -->
    <script src="/js/checkout-validation.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cartContainer = document.getElementById('cart-items-container');
            const cart = JSON.parse(localStorage.getItem('cart')) || [];

            if (cart.length > 0) {
                cartContainer.innerHTML = ''; // Clear empty message
                let subtotal = 0;

                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    subtotal += itemTotal;

                    const itemHtml = `
                <div class="product-item d-flex align-items-center mb-3">
                    <div class="product-image bg-light d-flex align-items-center justify-content-center rounded" style="width: 60px; height: 60px;">
                        <i class="bi bi-box-seam text-secondary fs-4"></i>
                    </div>
                    <div class="product-details ms-3 flex-grow-1">
                        <h6 class="mb-0 text-truncate" style="max-width: 150px;">${item.name}</h6>
                        <small class="text-muted">Qty: ${item.quantity}</small>
                    </div>
                    <div class="product-price text-end">
                        <strong>$${itemTotal.toFixed(2)}</strong>
                    </div>
                </div>`;
                    cartContainer.innerHTML += itemHtml;
                });

                // Update totals
                const shipping = 15.00;
                const taxRate = 0; // Keeping simple
                const tax = subtotal * taxRate;
                const total = subtotal + shipping + tax;

                document.getElementById('cart-subtotal').textContent = '$' + subtotal.toFixed(2);
                document.getElementById('cart-shipping').textContent = '$' + shipping.toFixed(2);
                document.getElementById('cart-tax').textContent = '$' + tax.toFixed(2);
                document.getElementById('cart-total').textContent = '$' + total.toFixed(2);
            }
        });
    </script>

    <%- include('partials/footer') %>